<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{block/head :: head}"></head>

    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Подтвердите удаление</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                </div>
                <div class="modal-body">
                    <p>Вы точно хотите удалить пользователя?</p>
                </div>
                <div class="modal-footer">
                    <form id = delete-form method="post">
                        <button class="btn btn-outline-danger" type="submit" name="delete" value="delete">Удалить</button>
                    </form>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>

    <body>
        <header th:insert="~{block/header :: header}"></header>
        <main>
            <div class="container">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Логин</th>
                            <th scope="col">ФИО</th>
                            <th scope="col">ИНН</th>
                            <th scope="col">Почта</th>
                            <th scope="col">Роли</th>
                            <th scope="col">Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each = "user : ${users}">
                            <th th:text = "${user.id}" scope="row"></th>
                            <td th:text = "${user.username}"></td>

                            <td th:text = "${user.surname} + ' ' + ${user.name} + ' ' + ${user.patronymic}"></td>
                            <td th:text = "${user.IndividualTaxpayerNumber}"></td>

                            <td th:text = "${user.email}"></td>
                            <td>
                                <span th:each = "role : ${user.roles}" th:text = "${role.name} + ' '"></span>
                            </td>
                            <td>
                                <form th:action="@{/admin/user/{id}(id=${user.id})}" method="get">
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/admin/user/{id}(id=${user.id})}"
                                           class="btn btn-outline-info btn-sm"
                                           role="button">
                                            Редактировать
                                        </a>
                                        <button type="button"
                                                class="btn btn-outline-danger btn-sm"
                                                data-bs-toggle="modal"
                                                data-bs-target="#exampleModalCenter"
                                                th:onclick="'addLink(' + ${user.id} + ')'">
                                            Удалить
                                        </button>
                                    </div>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <a href="admin/user" class="btn btn-primary" role="button">Добавить пользователя</a>
            </div>
        </main>
    </body>

    <script>
        const addLink = (id) => {
            document.getElementById('delete-form').setAttribute("action", `admin/user/${id}`)
        }
    </script>

    </div>
</html>